# Internationalization (i18n) Guide

This guide explains how to add and manage translations in the ScamNemesis project.

## Overview

The project supports 4 languages:
- **English (en)** - Default
- **Slovak (sk)**
- **Czech (cs)**
- **German (de)**

## File Structure

```
src/
├── lib/i18n/
│   ├── context.tsx          # I18nProvider and useTranslation hook
│   ├── config.ts             # Locale configuration
│   └── locales/
│       ├── en.json           # English translations
│       ├── sk.json           # Slovak translations
│       ├── cs.json           # Czech translations
│       └── de.json           # German translations
└── app/
    └── [locale]/             # Locale-prefixed routes
        ├── layout.tsx        # Wraps pages with I18nProvider
        ├── page.tsx
        └── your-page/
            └── page.tsx
```

## How It Works

1. **Routing**: All localized pages live under `/src/app/[locale]/`
2. **Provider**: The `[locale]/layout.tsx` wraps all pages with `I18nProvider`
3. **Hook**: Use `useTranslation()` hook to access translations

## Adding Translations to a New Page

### Step 1: Add translation keys to all 4 locale files

```json
// src/lib/i18n/locales/en.json
{
  "yourPage": {
    "hero": {
      "title": "Your Page Title",
      "description": "Your description text"
    },
    "features": ["Feature 1", "Feature 2", "Feature 3"]
  }
}
```

Repeat for `sk.json`, `cs.json`, and `de.json` with translated content.

### Step 2: Use translations in your page component

```tsx
'use client';

import { useTranslation } from '@/lib/i18n/context';

export default function YourPage() {
  const { t, locale } = useTranslation();

  // Simple string translation
  const title = t('yourPage.hero.title');

  // Array translation (requires type assertion)
  const features = (t('yourPage.features') as unknown as string[]) || [];

  // Object array translation
  const items = (t('yourPage.items') as unknown as { title: string; desc: string }[]) || [];

  return (
    <div>
      <h1>{title}</h1>
      <ul>
        {features.map((feature, i) => (
          <li key={i}>{feature}</li>
        ))}
      </ul>

      {/* Use locale for internal links */}
      <Link href={`/${locale}/contact-us`}>Contact</Link>
    </div>
  );
}
```

## Translation Patterns

### Simple Strings

```json
{
  "hero": {
    "title": "Welcome",
    "subtitle": "Your trusted platform"
  }
}
```

```tsx
const title = t('hero.title');
```

### Arrays of Strings

```json
{
  "features": [
    "Feature one",
    "Feature two",
    "Feature three"
  ]
}
```

```tsx
const features = (t('features') as unknown as string[]) || [];
features.map((item, i) => <li key={i}>{item}</li>)
```

### Arrays of Objects

```json
{
  "steps": [
    { "title": "Step 1", "description": "Do this first" },
    { "title": "Step 2", "description": "Then do this" }
  ]
}
```

```tsx
interface Step {
  title: string;
  description: string;
}

const steps = (t('steps') as unknown as Step[]) || [];
steps.map((step, i) => (
  <div key={i}>
    <h3>{step.title}</h3>
    <p>{step.description}</p>
  </div>
))
```

### Safe Array Access Pattern

Always use fallback to prevent `.map is not a function` errors:

```tsx
// CORRECT - with fallback
const items = (t('key') as unknown as string[]) || [];

// INCORRECT - may crash if translation is missing
const items = t('key') as unknown as string[];
items.map(...) // Crashes if items is undefined
```

### Conditional Array Rendering

For extra safety with array translations:

```tsx
{(() => {
  const items = t('key');
  if (Array.isArray(items)) {
    return items.map((item, i) => <li key={i}>{item}</li>);
  }
  return null;
})()}
```

## Best Practices

### 1. Structure translation keys hierarchically

```json
{
  "pageName": {
    "hero": { ... },
    "features": { ... },
    "cta": { ... }
  }
}
```

### 2. Keep translations consistent across all locale files

When adding a new key to `en.json`, immediately add it to all other locale files.

### 3. Use the locale for internal links

```tsx
const { locale } = useTranslation();
<Link href={`/${locale}/contact-us`}>Contact</Link>
```

### 4. Never hardcode text in components

```tsx
// BAD
<h1>Welcome to ScamNemesis</h1>

// GOOD
<h1>{t('hero.title')}</h1>
```

### 5. Test all 4 locales after making changes

Navigate to `/en/your-page`, `/sk/your-page`, `/cs/your-page`, `/de/your-page` to verify.

## Adding a New Language

1. Create `src/lib/i18n/locales/[code].json` with all translations
2. Update `src/lib/i18n/config.ts` to include the new locale
3. Update the locale switcher component
4. Test all pages in the new locale

## Common Issues

### "useI18n must be used within an I18nProvider"

**Cause**: Component is rendered outside the `[locale]` folder.

**Fix**: Move the page to `/src/app/[locale]/your-page/` or add a redirect from the non-locale route.

### ".map is not a function"

**Cause**: Translation key doesn't exist or returns wrong type.

**Fix**:
1. Verify key exists in all locale files
2. Add fallback: `(t('key') as unknown as string[]) || []`

### Missing translations show key path

**Cause**: Key doesn't exist in current locale.

**Fix**: Add the missing key to the locale file.

## Checklist for Adding i18n to a Page

- [ ] Add translations to `en.json`
- [ ] Add translations to `sk.json`
- [ ] Add translations to `cs.json`
- [ ] Add translations to `de.json`
- [ ] Update page to use `useTranslation()` hook
- [ ] Replace all hardcoded strings with `t()` calls
- [ ] Use array fallbacks for `.map()` operations
- [ ] Update internal links to use `/${locale}/path`
- [ ] Test page in all 4 locales
- [ ] Run tests: `pnpm test`
